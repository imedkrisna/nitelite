% Pandoc/Quarto template for den-paper extension
\documentclass[
  manuscript=$if(manuscript)$$manuscript$$else$article$endif$,
  layout=$if(layout)$$layout$$else$preprint$endif$,
  year=$if(year)$$year$$else$20xx$endif$,
  volume=$if(volume)$$volume$$else$x$endif$,
]{den}

% DOI
$if(doi)$
\doi{$doi$}
$endif$

% Conference (for proceedings/poster)
$if(conference)$
\conference{$conference$}
$endif$

% Dates
$if(received)$
\received{$received$}
$endif$
$if(revised)$
\revised{$revised$}
$endif$
$if(accepted)$
\accepted{$accepted$}
$endif$
$if(published)$
\published{$published$}
$endif$

% Editor and reviewers
$if(paper-editor)$
\editor{$paper-editor$}
$endif$
$if(paper-reviewers)$
\reviewers{$paper-reviewers$}
$endif$

% Strip abstract fields from bibliography entries (prevents LuaLaTeX parsing issues)
$if(cite-method-biblatex)$
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \step[fieldset=abstract, null]
    }
  }
}
$endif$

% Title
\title{$title$$if(title-footnote)$\footnote{$title-footnote$}$endif$}

% Authors and affiliations
$for(by-author)$
\author{$it.name.literal$$if(it.orcid)$ \orcid{$it.orcid$}$endif$}
$for(it.affiliations)$
\affiliation{$it.name$}
$endfor$
$if(it.email)$
\email{$it.email$}
$endif$
$endfor$

% Keywords
$if(keywords)$
\keywords{$for(keywords)$$keywords$$sep$; $endfor$}
$endif$

% Abbreviations
$if(paper-abbreviations)$
\abbreviations{
$for(paper-abbreviations)$
    $paper-abbreviations.short$: $paper-abbreviations.long$$sep$,
$endfor$
}
$endif$

% Pandoc/Quarto compatibility macros
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\providecommand{\citeproc}[2]{#1}
\providecommand{\citeproctext}{}

% Support for graphics
\RequirePackage{graphicx}

% Support for ding symbols (checkmarks, etc.)
\RequirePackage{pifont}

% Support for table column width calculations (required by Quarto-generated tables)
\RequirePackage{calc}

% Pandoc image handling - required for newer Pandoc/Quarto versions
% Constrains images to text width to prevent overflow
\makeatletter
\providecommand{\pandocbounded}[1]{%
  \sbox0{#1}%
  \ifdim\wd0>\linewidth
    \resizebox{\linewidth}{!}{#1}%
  \else
    #1%
  \fi
}
\makeatother

% CSL references support
$if(csl-refs)$
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\makeatletter
\newcommand{\CSLNoBibLabel}{\renewcommand{\@biblabel}[1]{}}
\makeatother
\newenvironment{CSLReferences}[2]
 {\begin{list}{}%
  {\setlength{\leftmargin}{0pt}
   \setlength{\itemindent}{0pt}
   \setlength{\itemsep}{#2\baselineskip}
   \setlength{\parsep}{0pt}
   \setlength{\topsep}{0pt}
   \setlength{\partopsep}{0pt}
   \ifodd #1
     \setlength{\leftmargin}{\cslhangindent}
     \setlength{\itemindent}{-\cslhangindent}
   \fi}
  \CSLNoBibLabel}
 {\end{list}}
$endif$

% Header includes
$for(header-includes)$
$header-includes$
$endfor$

% Keep internal links clickable without PDF border underlines.
\hypersetup{pdfborder={0 0 0}}

% Source note environment for figure attributions (right-aligned, compact)
\newenvironment{source}{%
  \vspace{-1em}%
  \begin{flushright}\scriptsize\itshape
}{%
  \end{flushright}%
}
\newcommand{\sumber}[1]{%
  \vspace{-1em}%
  \begin{flushright}\scriptsize\itshape
  Sumber: #1
  \end{flushright}%
}

% Allow LaTeX more flexibility in line breaking to prevent overflow
% (needed for Indonesian/non-English text on narrow B5 paper)
\tolerance=1000
\emergencystretch=1.5em

\begin{document}

$if(abstract)$
\begin{abstract}
$abstract$
\end{abstract}
$endif$

$body$

\end{document}
